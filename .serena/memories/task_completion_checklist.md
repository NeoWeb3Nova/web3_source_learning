# 任务完成清单

## 🚨 绝对必须遵守的核心准则

### -1. 开始新任务前的强制检查（绝对必须执行）
- [ ] **🔍 全面检查上一个任务是否真正完成**：使用serena工具验证上一个任务的所有要求都已满足
- [ ] **📋 检查任务状态文件**：确认上一个任务在tasks.md中已标记为完成 [x]
- [ ] **🔍 验证代码实现**：使用serena检查上一个任务的所有代码是否已正确实现
- [ ] **📝 检查内存记录**：确认上一个任务的完成情况已记录到内存文件
- [ ] **🧪 验证功能完整性**：确认上一个任务的所有功能都能正常工作
- [ ] **❌ 禁止跳过检查**：绝对不允许在未完成上一个任务的情况下开始新任务
- [ ] **🔄 补完未完成项**：如发现上一个任务有未完成项，必须先完成后再开始新任务

### 0. Serena工具使用要求（必须执行）
- [ ] **优先使用serena工具**：所有代码分析、文件操作、符号查找必须使用serena
- [ ] **使用 `mcp_serena_think_about_task_adherence`**：开始任务前确认任务理解正确
- [ ] **使用 `mcp_serena_get_symbols_overview`**：分析现有代码结构
- [ ] **使用 `mcp_serena_find_symbol`**：查找和分析相关符号
- [ ] **使用 `mcp_serena_replace_symbol_body`**：修改现有代码
- [ ] **使用 `mcp_serena_insert_after_symbol` / `mcp_serena_insert_before_symbol`**：添加新代码
- [ ] **使用 `mcp_serena_think_about_collected_information`**：分析收集的信息是否充分
- [ ] **使用 `mcp_serena_think_about_whether_you_are_done`**：确认任务完成
- [ ] **使用 `mcp_serena_write_memory`**：记录任务完成情况和重要信息
- [ ] **禁止绕过serena**：遇到serena问题时应调试解决，不得切换到其他工具

## 代码开发完成后的检查步骤

### 1. 代码质量检查
- [ ] 运行 `npm run lint` 确保没有ESLint错误
- [ ] 运行 `npm run format` 格式化代码
- [ ] 检查TypeScript类型错误
- [ ] 确保所有导入路径正确

### 2. 功能测试
- [ ] 运行 `npm run test` 确保所有测试通过
- [ ] 手动测试新功能在不同屏幕尺寸下的表现
- [ ] 测试错误处理和边界情况
- [ ] 验证响应式设计在移动端的表现

### 3. 性能检查
- [ ] 检查组件是否使用了React.memo、useMemo、useCallback等优化
- [ ] 确保没有不必要的重新渲染
- [ ] 验证懒加载和代码分割是否正常工作
- [ ] 检查网络请求是否有适当的缓存和重试机制

### 4. 用户体验检查
- [ ] 确保加载状态有适当的Skeleton或Loading指示器
- [ ] 验证错误状态有友好的错误提示
- [ ] 检查所有交互都有适当的视觉反馈
- [ ] 确保无障碍访问支持（ARIA标签、键盘导航等）

### 5. 代码规范检查
- [ ] 组件Props有完整的TypeScript类型定义
- [ ] 所有公共函数和接口有JSDoc注释
- [ ] 文件导入顺序符合约定
- [ ] 组件结构符合项目约定

### 6. Git提交前检查
- [ ] 确保所有文件都已保存
- [ ] 运行完整的构建 `npm run build` 确保无错误
- [ ] 检查Git状态，确保没有意外的文件更改
- [ ] 编写清晰的提交信息

### 7. 文档更新
- [ ] 更新相关的README或文档
- [ ] 如果添加了新的API或组件，更新类型定义
- [ ] 更新任务列表状态（如果适用）
- [ ] **使用serena记录任务完成情况到内存**

### 8. 部署前检查
- [ ] 运行 `npm run preview` 测试生产构建
- [ ] 检查所有环境变量配置正确
- [ ] 验证所有外部依赖和API调用正常

## 上一个任务完成检查流程（开始新任务前必须执行）

### 第一步：检查任务状态
```
1. mcp_serena_search_for_pattern (tasks.md)
   - 搜索上一个任务的状态标记
   - 确认是否已标记为 [x] 完成

2. 如果未标记完成：
   - 立即停止，不得开始新任务
   - 返回完成上一个任务
```

### 第二步：验证代码实现
```
1. mcp_serena_read_memory (上一个任务的内存记录)
   - 读取上一个任务的完成记录
   - 了解应该实现的功能

2. mcp_serena_find_file (相关文件)
   - 检查上一个任务创建的文件是否存在

3. mcp_serena_get_symbols_overview (关键文件)
   - 验证关键符号是否已实现

4. mcp_serena_find_symbol (核心功能)
   - 检查核心功能是否正确实现
```

### 第三步：功能完整性检查
```
1. 检查所有要求的功能是否都已实现
2. 验证代码是否能正常编译
3. 确认没有明显的功能缺失
4. 检查是否有未完成的TODO或FIXME
```

### 第四步：记录检查结果
```
1. mcp_serena_write_memory (检查结果)
   - 记录检查过程和结果
   - 如有问题，详细记录需要补完的内容

2. 如发现问题：
   - 必须先解决问题
   - 完成缺失的功能
   - 重新进行完整性检查
```

## Serena工具使用最佳实践

### 任务开始时（在完成上一个任务检查后）
1. `mcp_serena_think_about_task_adherence` - 确认任务理解
2. `mcp_serena_read_memory` - 读取相关内存文件
3. `mcp_serena_get_symbols_overview` - 分析现有代码结构
4. `mcp_serena_find_symbol` - 查找相关符号和组件

### 开发过程中
1. `mcp_serena_find_referencing_symbols` - 查找符号引用
2. `mcp_serena_replace_symbol_body` - 修改现有代码
3. `mcp_serena_insert_after_symbol` - 添加新代码
4. `mcp_serena_think_about_collected_information` - 验证信息充分性

### 任务完成时
1. `mcp_serena_think_about_whether_you_are_done` - 确认任务完成
2. `mcp_serena_write_memory` - 记录任务完成情况
3. 更新任务状态文件

### 遇到问题时
- **不要绕过serena**：应该调试和解决serena的问题
- 使用 `mcp_serena_search_for_pattern` 搜索相关代码
- 使用 `mcp_serena_list_dir` 了解项目结构
- 查看serena错误信息并相应调整

## 常见问题排查

### Serena工具问题
- 检查项目是否正确激活
- 确认文件路径使用相对路径
- 验证符号名称和路径正确性
- 检查是否需要先读取文件获取符号信息

### 上一个任务检查问题
- 如果找不到任务记录，检查内存文件列表
- 如果代码不存在，检查文件路径和命名
- 如果功能不完整，列出具体缺失项
- 如果有编译错误，先解决错误再继续

### TypeScript错误
- 检查类型导入是否正确
- 确保所有Props接口定义完整
- 验证枚举和联合类型使用正确

### 样式问题
- 确保Chakra UI主题配置正确
- 检查响应式断点设置
- 验证CSS-in-JS样式语法

### 性能问题
- 使用React DevTools Profiler分析性能
- 检查是否有内存泄漏
- 优化大列表渲染

### 测试失败
- 检查测试环境配置
- 确保模拟数据和API调用正确
- 验证异步操作的测试写法

## 任务完成标准

一个任务只有在满足以下条件时才算真正完成：

1. ✅ **全程使用serena工具**
2. ✅ **代码质量检查通过**
3. ✅ **功能测试通过**
4. ✅ **性能检查通过**
5. ✅ **用户体验检查通过**
6. ✅ **代码规范检查通过**
7. ✅ **文档更新完成**
8. ✅ **使用serena记录任务完成情况**
9. ✅ **下一个任务开始前的检查已通过**

## 违规处理

### 如果发现没有使用serena工具完成任务：
- 必须重新使用serena工具完成相关步骤
- 补充使用serena记录任务完成情况
- 更新相关内存文件

### 如果发现跳过了上一个任务的完成检查：
- 立即停止当前任务
- 返回检查上一个任务的完成情况
- 补完上一个任务的缺失项
- 重新开始当前任务

### 如果发现上一个任务未完成就开始新任务：
- 这是严重违规行为
- 必须立即停止当前任务
- 完整完成上一个任务的所有要求
- 记录违规情况和补救措施

## 🚫 绝对禁止的行为

1. **禁止跳过上一个任务检查**：这是最严重的违规
2. **禁止绕过serena工具**：不得因为serena报错就切换到其他工具
3. **禁止跳过分析阶段**：不得不分析现有代码就直接修改
4. **禁止不记录完成情况**：不得完成任务后不记录完成情况
5. **禁止盲目修改代码**：不得不了解符号引用就修改代码

## 💡 最佳实践

1. **严格按顺序执行**：绝不跳过任何检查步骤
2. **详细记录过程**：每个重要步骤都要有记录
3. **及时发现问题**：在问题扩大前及时发现和解决
4. **保持代码质量**：始终维护高标准的代码质量
5. **持续改进流程**：根据实际情况优化工作流程

遵循这个更新的指南，确保每个任务都建立在前一个任务的坚实基础上！